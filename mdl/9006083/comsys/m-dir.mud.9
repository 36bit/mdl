<PACKAGE "M.DIR">

<ENTRY DIR? CREATED?>

<USE "NSTR">

<DEFINE DIR? (NM)
	#DECL ((NM) STRING)
	<HAS-DIR? <CHTYPE <STRTOX .NM> FIX>>>

<DEFINE CREATED? (NM1 NM2 DEV SNM)
	#DECL ((NM1 NM2 DEV SNM) STRING (VALUE) <OR FIX FALSE>)
	<CREATION-DATE <CHTYPE <STRTOX .NM1> FIX>
		       <CHTYPE <STRTOX .NM2> FIX>
		       <CHTYPE <STRTOX .DEV> FIX>
		       <CHTYPE <STRTOX .SNM> FIX>>>

<TITLE HAS-DIR?>
	<DECLARE ("VALUE" <OR ATOM FALSE> <PRIMTYPE WORD>)>
	<DPUSH	TP* (AB)>
	<PUSHJ	P* IHASDIR>
	<JRST	FINIS>

<INTERNAL-ENTRY IHASDIR 1>
	<SUBM	M* (P)>
	<*IOPUS>
	<*CALL	[<SETZ>
		 <SIXBIT "OPEN">
		 <MOVEI 0>
		 <MOVE [<SIXBIT "DSK">]>
		 <MOVE [<SIXBIT ".FILE.">]>
		 <MOVE [<SIXBIT "(DIR)">]>
		 <SETZ (TP)>]>
	 <JRST	NOPE>
	<MOVE	A* <PQUOTE 'T>>
	<MOVE	B* <MQUOTE 'T>>
EXIT	<*IOPOP>
	<SUB	TP* [<2 (2)>]>
	<JRST	MPOPJ>

NOPE	<MOVSI	A* <TYPE-CODE FALSE>>
	<SETZ	B*>
	<JRST	EXIT>

<SUB-ENTRY CREATION-DATE ("VALUE" <OR FIX FALSE> FIX FIX FIX FIX)>
	<MOVE	A* AB>
	<PUSH	TP* (A)>
	<AOBJN	A* HERE -1>
	<PUSHJ	P* ICREATE>
	<JRST	FINIS>

<INTERNAL-ENTRY ICREATE 4>
	<SUBM	M* (P)>
	<*IOPUS>
	<*CALL	[<SETZ>
		 <SIXBIT "OPEN">
		 <MOVEI 0>
		 <MOVE -2 (TP)>
		 <MOVE -6 (TP)>
		 <MOVE -4 (TP)>
		 <SETZ (TP)>]>
	 <JRST NODATE>
	<*CALL	[<SETZ>
		 <SIXBIT "RFDATE">
		 <MOVEI 0>
		 <SETZM B>]>
	 <JRST NODATE>
	<MOVSI	A* <TYPE-CODE FIX>>
CEXIT	<*IOPOP>
	<SUB	TP* [<8 (8)>]>
     	<JRST	MPOPJ>

NODATE	<MOVSI	A* <TYPE-CODE FALSE>>
	<SETZ	B*>
	<JRST	CEXIT>
<END>

<ENDPACKAGE>
