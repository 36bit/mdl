<PACKAGE "M-DIR">

<ENTRY DIR? CREATED?>

<DEFINE CREATED? (NM1 NM2 DEV SNM "AUX" C D)
	#DECL ((NM1 NM2 DEV SNM) STRING (VALUE) <OR FIX FALSE>)
	<COND (<SET C <OPEN "READ" .NM1 .NM2 .DEV .SNM>>
	       <SET D <CREATION-DATE .C>>
	       <CLOSE .C>
	       .D)>>

<TITLE DIR?>
	<DECLARE ("VALUE" <OR ATOM FALSE> STRING)>
	<DPUSH	TP* (AB)>
	<PUSHJ	P* IHASDIR>
	<JRST	FINIS>

<INTERNAL-ENTRY IHASDIR 1>
	<SUBM	M* (P)>
	<MOVSI	A* *11*>
	<MOVE	B* (TP)>
	<HRRZ	C* -1(TP)>
	<MOVNS	C>
	<MOVE	B* (TP)>
	<HRROI	A* 1(P)>
	<SOUT>
	<MOVEI	B* 0>
	<IDPB	B* A>
	<HRLI	A* 1>
	<HRROI	B* 1(P)>
	<RCDIR>
	<TLNE	A* *70000*>
	 <JRST	NOPE>
	<MOVE	A* <PQUOTE 'T>>
	<MOVE	B* <MQUOTE 'T>>
EXIT	<SUB	TP* [<2 (2)>]>
	<JRST	MPOPJ>

NOPE	<MOVSI	A* <TYPE-CODE FALSE>>
	<SETZ	B*>
	<JRST	EXIT>

<SUB-ENTRY CREATION-DATE ("VALUE" <OR FIX FALSE> CHANNEL)>
	<DPUSH	TP* (AB)>
	<PUSHJ	P* ICREATE>
	<JRST	FINIS>

<INTERNAL-ENTRY ICREATE 1>
	<SUBM	M* (P)>
	<MOVE	A* (TP)>
	<MOVE	A* 1(A)>
	<MOVEI	B* 1(P)>
	<MOVEI	C* 2>
	<RFTAD>
	<SKIPG	B* 1(B)>
	 <JRST NODATE>
	<MOVSI	A* <TYPE-CODE FIX>>
CEXIT	<SUB	TP* [<2 (2)>]>
     	<JRST	MPOPJ>

NODATE	<MOVSI	A* <TYPE-CODE FALSE>>
	<SETZ	B*>
	<JRST	CEXIT>
<END>

<ENDPACKAGE>
