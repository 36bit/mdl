'<PCODE "GNJFNX">

<PACKAGE "GNJFN"> 

<ENTRY NEXT-FILE GNJFN-RESET GET-TABLE DO-SYSGT DO-GETAB CUR-STATE DO-RFTAD 
DO-GFUST DO-ODTIM DO-STDEV DO-DVCHR> 

<USE "NSTR"> 

<SETG LAST-SPEC ""> 

<SETG FILE-SCRATCH <ISTRING 100>> 

<GDECL (LAST-SPEC) STRING (FILE-SCRATCH) STRING> 

"On 20x, the state is simply a JFN (full-word), which can be passed
to GNJFN.  If it is false, we aren't initialized.  On ITS, the state is
a pair:  a pointer into a uvector of directories to be searched, and
a pointer into the current directory." 

<SETG CUR-STATE <>> 

"Takes a file spec, including *'s, and returns a vector containing
a string and bits as for the GNJFN call, or false if no more files." 

<SETG NEXT-FILE  %<RSUBR!- '[ %<PCODE!- "GNJFNX" 0> NEXT-FILE #DECL ("VALUE" <OR
FALSE <VECTOR STRING>> "OPTIONAL" STRING <OR FALSE <VECTOR ANY>>) STRTOX %<RGLOC
LAST-SPEC T> %<RGLOC CUR-STATE T> %<RGLOC FILE-SCRATCH T>]>> 
<AND <ASSIGNED? GLUE> .GLUE <PUT ,NEXT-FILE PGLUE ![536870912!]>> 


<SETG GNJFN-RESET %<RSUBR-ENTRY '[NEXT-FILE GNJFN-RESET #DECL ("VALUE" FALSE 
"OPTIONAL" <OR ATOM FALSE>)] 152>> 

<SETG GET-TABLE %<RSUBR-ENTRY '[NEXT-FILE GET-TABLE #DECL ("VALUE" <OR FALSE <
UVECTOR [REST WORD]>> <OR STRING <PRIMTYPE WORD>>)] 205>> 

<SETG DO-STDEV %<RSUBR-ENTRY '[NEXT-FILE DO-STDEV #DECL ("VALUE" <OR FALSE WORD>
STRING)] 273>> 

<SETG DO-DVCHR %<RSUBR-ENTRY '[NEXT-FILE DO-DVCHR #DECL ("VALUE" WORD <PRIMTYPE 
WORD>)] 287>> 

<SETG DO-RFTAD %<RSUBR-ENTRY '[NEXT-FILE DO-RFTAD #DECL ("VALUE" <UVECTOR [REST 
WORD]> <OR CHANNEL FIX> "OPTIONAL" <UVECTOR [REST WORD]>)] 297>> 

<SETG DO-GFUST %<RSUBR-ENTRY '[NEXT-FILE DO-GFUST #DECL ("VALUE" STRING <OR 
CHANNEL FIX> FIX "OPTIONAL" STRING)] 335>> 

<SETG DO-ODTIM %<RSUBR-ENTRY '[NEXT-FILE DO-ODTIM #DECL ("VALUE" ANY <PRIMTYPE 
WORD> <OR CHANNEL STRING> "OPTIONAL" <PRIMTYPE WORD>)] 395>> 

<SETG DO-GETAB %<RSUBR-ENTRY '[NEXT-FILE DO-GETAB #DECL ("VALUE" <OR FALSE WORD>
<PRIMTYPE WORD> FIX)] 506>> 

<SETG DO-SYSGT %<RSUBR-ENTRY '[NEXT-FILE DO-SYSGT #DECL ("VALUE" WORD <OR STRING
<PRIMTYPE WORD>> "OPTIONAL" <OR ATOM FALSE>)] 528>> 

<ENDPACKAGE> 
