'<PCODE "1M-CHA">

<PACKAGE "M-CHAOS"> 

<ENTRY CHAOSNET-DELIVERY MAIL-FILE CHAOS-QUIT CHAOS-SOAK?> 

<USE "MADMAN" "CHAN" "CLOCK" "ITIME" "HOSTS" "CHAOS"> 

<USE "FIELDS" "M-DEFS" "M-TIME" "M-PRCD" "M-READ" "M-DAC" "M-DOUT" "M-DATA" 
"M-BASE" "PRTUTI" "PRTSTR" "M-ERR" "USRUTI"> 

<SETG CHAOS-SOAK? <>> 

<SETG CHAOS-CONNECTION <>> 

<GDECL (CHAOS-SOAK?) <OR ATOM FALSE> (CHAOS-CONNECTION) <OR FALSE <LIST FIX 
STRING>>> 

\ 

"CHAOSNET-DELIVERY -- CHAOSnet output for message." 

<SETG CHAOSNET-DELIVERY  %<RSUBR!- '[ %<PCODE!- "1M-CHA" 0> CHAOSNET-DELIVERY #
DECL ("VALUE" <OR ATOM FALSE> STRING STRING FIX) CHAOS-RESP CHAOS-OPER CHAOS-OUT
 CHAOS-CLOSE FLUSH-NET-MESSAGE ALARM-OFF IGNORE MAIL-RESULT QPEEK AFALSE ALARM 
WATCH DRDMSG SPLITS? SCROUT CHAOS-OPEN HOST MAIL-TEMP-FILE "MAIL" %<RGLOC 
ICP-TRIES T> "." %<RGLOC CHAOS-CONNECTION T> "DEVICE NOT READY" 
"CHAOSnet apparently down" "Retrying ICP" %<TYPE-W CINT VECTOR> "" "QSEND" %<
RGLOC MSG-SPACE T> %<TYPE-W SPACE VECTOR> "READ" %<RGLOC NET-MESSAGE T> NETOUT (
ACTIVATION) EHAN "ERROR" %<RGLOC ERRHND T> IHAN "IOC" %<RGLOC IOCHND T> %<RGLOC 
TIMED-OUT T> "SEND" "ICP Successful" %<RGLOC XRCP-LIST T> %<INTERNAL-RSUBR ACOPY
 2> "DELIVERY" T %<INTERNAL-RSUBR ASTRING 262143> "CHAOS closed" WAIT-ACT %<
RGLOC TEMPSTR T> OUTCHAN %<RGLOC CHAOS-SOAK? T> "CHA: " "     "]>> 
<AND <ASSIGNED? GLUE> .GLUE <PUT ,CHAOSNET-DELIVERY PGLUE ![715827882 
-23622320128 0 0!]>> 


\ 

"CHAOS-ICP -- open a CHAOSNET connection" 

<SETG CHAOS-ICP %<RSUBR-ENTRY '[CHAOSNET-DELIVERY CHAOS-ICP #DECL ("VALUE" <OR 
FALSE <LIST FIX STRING>> <OR FIX STRING> "OPTIONAL" ANY)] 26>> 

\ 

"MAIL-FILE -- given addressee and file containing mail, send it" 

<SETG MAIL-FILE %<RSUBR-ENTRY '[CHAOSNET-DELIVERY MAIL-FILE #DECL ("VALUE" ANY 
STRING STRING FIX <OR STRING CHANNEL>)] 147>> 

\ 

"CONNECTED?" 

<SETG CONNECTED? %<RSUBR-ENTRY '[CHAOSNET-DELIVERY CONNECTED? #DECL ("VALUE" <OR
FALSE <LIST FIX STRING>> <OR FIX VECTOR>)] 455>> 

\ 

"CHAOS-QUIT -- flush ftp connection" 

<SETG CHAOS-QUIT %<RSUBR-ENTRY '[CHAOSNET-DELIVERY CHAOS-QUIT #DECL ("VALUE" <OR
FALSE <LIST FIX STRING>>)] 487>> 

\ 

"SEND-MAIL -- copy mail file open on first arg to ftp." 

<SETG SEND-MAIL %<RSUBR-ENTRY '[CHAOSNET-DELIVERY SEND-MAIL #DECL ("VALUE" ANY 
CHANNEL FIX)] 517>> 

<SETG CHAOS-COPY %<RSUBR-ENTRY '[CHAOSNET-DELIVERY CHAOS-COPY #DECL ("VALUE" 
ATOM CHANNEL FIX)] 581>> 

<SETG TEMPSTR <ISTRING 100>> 

<GDECL (TEMPSTR) STRING> 

<SETG CHAOS-WAIT %<RSUBR-ENTRY '[CHAOSNET-DELIVERY CHAOS-WAIT #DECL ("VALUE" <OR
FALSE FIX> FIX)] 635>> 

"FTP-REPLY -- analyzes an FTP reply and returns an appropriate false
if it is not a winner." 

<SETG FTP-REPLY %<RSUBR-ENTRY '[CHAOSNET-DELIVERY FTP-REPLY #DECL ("VALUE" ANY 
ANY FIX FIX FIX)] 717>> 

"PR -- print message to net channel and script" 

<SETG PR %<RSUBR-ENTRY '[CHAOSNET-DELIVERY PR #DECL ("VALUE" <OR FALSE FIX> 
STRING FIX)] 778>> 

<ENDPACKAGE> 
