'<PCODE "5M-PRS">

<PACKAGE "M-PRS"> 

<ENTRY PARSING STORE-PARSE PRS-ERR MAIL-PARSE MPARSE-FIELD-TABLE MPDATE ADDFLD> 

<USE "FIELDS" "USRUTI" "HOSTS" "PRTUTI" "M-DEFS" "ITIME" "M-PRCD" "M-READ" 
"M-DAC" "MADMAN" "M-ERR" "VCTSRC" "NSTR"> 

"PARSING PROCESS" 

<DEMON-PROCESS "PARSING" PARSING PRS-ERR [,FATAL <> ,FATAL <> ,FATAL ,FATAL]> 

\ 

<SETG DC <STRING <ASCII 13> <ASCII 10> <ASCII 13> <ASCII 10>>> 

<SETG CR "
"> 

<GDECL (DC CR) STRING> 

<SETG PARSING  %<RSUBR!- '[ %<PCODE!- "5M-PRS" 0> PARSING #DECL ("VALUE" <OR 
ATOM FALSE> ADDRESS) BTIME LC-UC ZONE SUBSNC VCTSRC SUBSTR ADDBACK HOST MID 
HOME? F==? MEMF FGETFIX DWT ITIME AFALSE DRDMSG %<RGLOC MSG-SPACE T> %<TYPE-W 
SPACE VECTOR> %<RGLOC SCRATCH-SPACE T> T %<INTERNAL-RSUBR ALIST 262143> (
"SUBJECT" "MESSAGE-ID") %<INTERNAL-RSUBR ASTRING 262143> %<INTERNAL-RSUBR ACOPY 
2> "MESSAGE" "BLIND" "REPLY-TO" %<RGLOC MDB T> 
"     The parsing process failed because:

" "It was applied to the receiver area of the message." 
"There was no text to be parsed." 
"An error return from MAIL-PARSE occurred.  The value returned was:
" ".  The text being parsed was:

" "--none--" 
"A bad data item was returned from MAIL-PARSE.  The item returned was:
" ", and the text being parsed was:
" %<RGLOC MPARSE-FIELD-TABLE T> "BODY" %<RGLOC DC T> %<RGLOC CR T> " 	" ":" 
"MISCELLANEOUS" ["WHEN-ORIGINATED" "SENDER"] " " " 	
" " at " CURSPACE (SPACE) ["SUN" "MON" "TUE" "WED" "THU" "FRI" "SAT"] ["JAN" 1 
"FEB" 2 "MAR" 3 "APR" 4 "MAY" 5 "JUN" 6 "JUL" 7 "AUG" 8 "SEP" 9 "OCT" 10 "NOV" 
11 "DEC" 12] "" "at" "am" "pm" %<INTERNAL-RSUBR AUVECTOR 262143> 
%<INTERNAL-RSUBR AISTRING 3>]>> 
<AND <ASSIGNED? GLUE> .GLUE <PUT ,PARSING PGLUE ![715827882 -25769803776 0 0!]>> 


<SETG STORE-PARSE %<RSUBR-ENTRY '[PARSING STORE-PARSE #DECL ("VALUE" <OR ATOM 
FALSE> LIST)] 38>> 

<SETG HFIX %<RSUBR-ENTRY '[PARSING HFIX #DECL ("VALUE" ANY <OR FIX FALSE> <OR 
FIX STRING>)] 372>> 

\ 

"PRS-ERR -- error analyzer" 

<SETG PRS-ERR %<RSUBR-ENTRY '[PARSING PRS-ERR #DECL ("VALUE" <OR LIST FALSE> 
STRING <FALSE FIX> ADDRESS)] 528>> 

\ 

<SETG MAIL-PARSE %<RSUBR-ENTRY '[PARSING MAIL-PARSE #DECL ("VALUE" LIST STRING)]
707>> 

<SETG ADDFLD %<RSUBR-ENTRY '[PARSING ADDFLD #DECL ("VALUE" <OR FALSE LIST VECTOR
> STRING ANY LIST)] 1057>> 

\ 

<SETG MPNO-OP %<RSUBR-ENTRY '[PARSING MPNO-OP #DECL ("VALUE" ANY ANY)] 1233>> 

<SETG MPKEYWORD %<RSUBR-ENTRY '[PARSING MPKEYWORD #DECL ("VALUE" <LIST [REST 
STRING]> <OR STRING FALSE>)] 1245>> 

<SETG COMMA? %<RSUBR-ENTRY '[PARSING COMMA? #DECL ("VALUE" <OR FALSE STRING> 
STRING)] 1348>> 

<SETG NUMBER? %<RSUBR-ENTRY '[PARSING NUMBER? #DECL ("VALUE" <OR FALSE FIX> 
STRING)] 1409>> 

<SETG BREAK? %<RSUBR-ENTRY '[PARSING BREAK? #DECL ("VALUE" <OR FALSE STRING> 
STRING)] 1444>> 

<SETG ANYTHING? %<RSUBR-ENTRY '[PARSING ANYTHING? #DECL ("VALUE" <OR FALSE 
STRING> STRING)] 1477>> 

<SETG BACK-ANYTHING? %<RSUBR-ENTRY '[PARSING BACK-ANYTHING? #DECL ("VALUE" 
STRING STRING)] 1509>> 

<SETG MACH-ID %<RSUBR-ENTRY '[PARSING MACH-ID #DECL ("VALUE" STRING STRING)] 
1557>> 

<SETG FULL-NAME %<RSUBR-ENTRY '[PARSING FULL-NAME #DECL ("VALUE" <OR FALSE 
STRING> STRING)] 1690>> 

<SETG HOST-NAME %<RSUBR-ENTRY '[PARSING HOST-NAME #DECL ("VALUE" <OR FALSE 
STRING> STRING)] 1879>> 

<SETG MPAUTHOR %<RSUBR-ENTRY '[PARSING MPAUTHOR #DECL ("VALUE" <LIST [REST 
STRING <OR FALSE STRING> <OR FALSE STRING> <OR FALSE STRING> <OR FALSE STRING>]>
ANY)] 1983>> 

"MPTO -- parse addressee fields" 

<SETG MPTO %<RSUBR-ENTRY '[PARSING MPTO #DECL ("VALUE" <OR FALSE <LIST [REST <
LIST [REST STRING <OR FALSE STRING> <OR FALSE STRING> <OR FALSE STRING> <OR 
FALSE STRING>]>]>> STRING)] 2133>> 

"MPMAIL-FROM -- parse normal tops-20 received-from-host analog" 

<SETG MPMAIL-FROM %<RSUBR-ENTRY '[PARSING MPMAIL-FROM #DECL ("VALUE" <OR ATOM 
FALSE FIX> STRING)] 2179>> 

\ 

"MPDATE -- parse normal net header date" 

<SETG MPDATE %<RSUBR-ENTRY '[PARSING MPDATE #DECL ("VALUE" <OR FALSE UVECTOR> 
STRING "OPTIONAL" ANY)] 2235>> 

<SETG PAREN? %<RSUBR-ENTRY '[PARSING PAREN? #DECL ("VALUE" STRING STRING)] 2819>
> 

<SETG ASUBSTRING %<RSUBR-ENTRY '[PARSING ASUBSTRING #DECL ("VALUE" STRING STRING
FIX "OPTIONAL" SPACE)] 2874>> 

\ 

<SETG MPARSE-FIELD-TABLE ["BCC" ["BLIND" ,MPTO] "CC" ["CARBON-COPY-TO" ,MPTO] 
"DATE" ["WHEN-ORIGINATED" ,MPDATE] "FROM" ["FROM" ,MPTO] "IN-REPLY-TO" [
"IN-REPLY-TO" ,MPNO-OP] "KEYWORDS" ["KEYWORDS" ,MPKEYWORD] "MAIL-FROM" [
"RECEIVED-FROM-HOST" ,MPMAIL-FROM] "MESSAGE-ID" ["MESSAGE-ID" ,MPNO-OP] 
"REFERENCES" ["REFERENCES" ,MPKEYWORD] "REPLY-TO" ["REPLY-TO" ,MPTO] "SENDER" [
"SENDER" ,MPTO] "SUBJECT" ["SUBJECT" ,MPNO-OP] "TO" ["TO" ,MPTO]]> 

<GDECL (MPARSE-FIELD-TABLE) <VECTOR [REST STRING <VECTOR STRING APPLICABLE>]>> 

<ENDPACKAGE> 
