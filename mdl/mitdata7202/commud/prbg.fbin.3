'<PCODE "2PRBG">

<PACKAGE "PRBG"> 

<ENTRY PRESENT-BITGRAPH-IMAGE PRESENT-BITMAP-IMAGE> 

<USE "SCR" "WINDOW" "M-DEFS" "MADMAN"> 

<SETG BG-BUFFER-SIZE 500> 

<SETG BG-MODE 3> 

<SETG BG-BOX 16> 

<GDECL (BG-BOX BG-BUFFER-SIZE BG-MODE) FIX> 

<SETG PRESENT-BITGRAPH-IMAGE  %<RSUBR!- '[ %<PCODE!- "2PRBG" 0> 
PRESENT-BITGRAPH-IMAGE #DECL ("VALUE" <OR ATOM FALSE> ANY ANY) GET-TTY TTY-RESET
 WINOP IMAGE-OUT ASTRING DPYOP!-ISCR AISTRING ARESET %<RGLOC SCRATCH-SPACE T> %<
TYPE-W SPACE VECTOR> "READB" "	**File not presentable: " %<RGLOC BG-BUFFER-SIZE
T> %<RGLOC BG-BOX T> %<RGLOC STREAM T> %<TYPE-W TTY VECTOR> "P:" %<RGLOC 
BG-MODE T> %<RGLOC CRSTR T> %<RGLOC SCRLF T> T "s" STREAM %<RGLOC OUTCHAN T> %<
RGLOC INCHAN T> %<RGLOC OUTCNT T> %<RGLOC CNT T> %<RGLOC WRD T> 
%<INTERNAL-RSUBR ARESET 1> %<INTERNAL-RSUBR ASTRING 262143> %<RGLOC OUTBUF T> %<
RGLOC UV T>]>> 
<AND <ASSIGNED? GLUE> .GLUE <PUT ,PRESENT-BITGRAPH-IMAGE PGLUE ![715816960 0 0!]
>> 


<SETG CRSTR <STRING <ASCII 13>>> 

<SETG SIZE-OF-BG-IMAGE %<RSUBR-ENTRY '[PRESENT-BITGRAPH-IMAGE SIZE-OF-BG-IMAGE #
DECL ("VALUE" LIST <OR CHANNEL FALSE> STRING)] 267>> 

<SETG READ-FIX %<RSUBR-ENTRY '[PRESENT-BITGRAPH-IMAGE READ-FIX #DECL ("VALUE" 
FIX STRING)] 369>> 

\ 

"PRESENT-BITMAP-IMAGE -- present a bitmap image on the BitGraph, converting
to appropriate format as we go." 

<SETG PRESENT-BITMAP-IMAGE %<RSUBR-ENTRY '[PRESENT-BITGRAPH-IMAGE 
PRESENT-BITMAP-IMAGE #DECL ("VALUE" <OR ATOM FALSE> <OR STRING CHANNEL> CHANNEL 
"OPTIONAL" FIX FIX)] 411>> 

<SETG WRD 0> 

<SETG CNT 1> 

<SETG UV <UVECTOR 0>> 

<GDECL (UV) UVECTOR (CNT WRD) FIX> 

<SETG NEXT-BYTE %<RSUBR-ENTRY '[PRESENT-BITGRAPH-IMAGE NEXT-BYTE #DECL ("VALUE" 
<OR FALSE FIX> ANY)] 805>> 

<SETG OUTCNT 0> 

<SETG OUTBUF <ISTRING <* </ 768 16> 3>>> 

<GDECL (OUTBUF) STRING (OUTCNT) FIX> 

<SETG OUTPUT-TRIPLE %<RSUBR-ENTRY '[PRESENT-BITGRAPH-IMAGE OUTPUT-TRIPLE #DECL (
"VALUE" FIX FIX)] 869>> 

<ENDPACKAGE> 
