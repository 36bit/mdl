'<PCODE "1BUF">

<PACKAGE "BUF"> 

<ENTRY ADDCHR ADDCRLF ADDFILE ADDSTRING ADD-OFFSET-STRING BSTR BCUR BPRMPT1 
BPRMPT2 BUF-BITS BUF-BIT-PROMPT BUF-ECHO-FLAG BUFCLEAR BUFFER BUFGROW BUFLENGTH 
BUFMAKE BUFPRINT BUFSIZE BUFSPRINT BUFTECO BUFTOS CHRTABLE DELCHR DELPRINT 
DELTOCH DISPLAY? DLINE DWORD FILEINP FORMATEFFS GET-CPOS GETSTR GETSTRACT 
HPOS-BUF IBUFCLEAR IBUFPRINT IDELCHR INIT ISDISPLAY? LINEBRKS QUOTECHR 
REENTER-TECO-CHAR TECO-PROGRAM UNKILL WORDBRKS> 

<USE "SCR" "GET-FILE"> 

<NEWTYPE BUFFER VECTOR '<<PRIMTYPE VECTOR> [4 STRING] FIX <PRIMTYPE WORD> STRING
FIX <OR ATOM FALSE>>> 

<SETG MSETG  %<RSUBR!- '[ %<PCODE!- "1BUF" 0> MSETG #DECL ("VALUE" ATOM ANY ANY)
 ADDSTRING GET-FILE DO-INPUT SET-IMAGE-MODE SET-ECHO-MODE TTY-SETUP TTY-SCR 
TTY-RESET DPYOP!-ISCR TCURSY TCURSX TERM-MOVE? GET-TTY DO-OUTPUT MANIFEST
	   "" %<TYPE-W BUFFER VECTOR> %<RGLOC BUFSIZE T> %<RGLOC STREAM T> 
%<TYPE-W TTY VECTOR> OUTCHAN INCHAN %<RGLOC DISPLAY? T> T "TTY" "-continued-" 
"
" (CHANNEL) "\\\"" "\\\\" %<RGLOC OUTCHAN T> "\"" %<RGLOC DELPRINT T> GETSTRACT 
%<RGLOC GLOBL-GETSTR-HAND T> ERROR!-INTERRUPTS INTERRUPT ELSE %<RGLOC 
GLOBL-GETSTR-CHAND T> %<RGLOC INCHAN T> #DISMISS T CHRTABLE STREAM (ACTIVATION) 
%<RGLOC BUF-ECHO-FLAG T> %<RGLOC WORDBRKS T> %<RGLOC LINEBRKS T> " XXX?" "" "File-name: " "READ" "[DONE]" "[File-Input Aborted]" ARG-WRONG-TYPE!-ERRORS 
ADDSTRING]>> 
<AND <ASSIGNED? GLUE> .GLUE <PUT ,MSETG PGLUE ![715827882 -1 -1 -268435456!]>> 


<PROG () <MSETG BSTR 1> <MSETG BCUR 2> <MSETG BPRMPT1 3> <MSETG BPRMPT2 4> <
MSETG INITIAL-HPOS 5> <MSETG BBITS 6> <MSETG BSAVED 7> <MSETG BSAVED-MAX 8> <
MSETG BDELETING 9>> 

<MSETG BUF-BIT-PROMPT 0> 

<DEFMAC BUF-BITS ('BUF 'BIT "OPTIONAL" 'NEW) <FORM BIND ((B .BUF) (BIT .BIT)) #
DECL ((B) BUFFER (BIT) <PRIMTYPE WORD>) <COND (<ASSIGNED? NEW> <FORM PUT <FORM 
LVAL B> ,BBITS <FORM PUTBITS <FORM BBITS <FORM LVAL B>> <FORM BITS 1 <FORM LVAL 
BIT>> <FORM COND (.NEW 1) (0)>>>) (T <FORM 1? <FORM CHTYPE <FORM GETBITS <FORM 
BBITS <FORM LVAL B>> <FORM BITS 1 <FORM LVAL BIT>>> FIX>>)>>> 

<SETG REENTER-TECO-CHAR !\> 

<SETG FORMATEFFS <MAPF ,STRING ,ASCII [13 10 14 9 32 8]>> 

<SETG WORDBRKS <STRING <ASCII 13> <ASCII 10> "	, ;:.">> 

<SETG LINEBRKS <STRING <ASCII 13> <ASCII 10>>> 

<SETG DELPRINT T> 

<SETG BUFSIZE 200> 

<SETG BUF-ECHO-FLAG <>> 

<GDECL (INCHAN) CHANNEL (DISPLAY?) <OR ATOM FALSE> (FORMATEFFS) STRING (BUFSIZE)
FIX> 

<SETG BUFMAKE %<RSUBR-ENTRY '[MSETG BUFMAKE #DECL ("VALUE" BUFFER FIX "OPTIONAL"
STRING STRING)] 20>> 

<SETG BUFLENGTH %<RSUBR-ENTRY '[MSETG BUFLENGTH #DECL ("VALUE" FIX BUFFER)] 88>> 

<SETG BUFGROW %<RSUBR-ENTRY '[MSETG BUFGROW #DECL ("VALUE" BUFFER BUFFER 
"OPTIONAL" FIX)] 105>> 

<SETG BUFFER-PRINT %<RSUBR-ENTRY '[MSETG BUFFER-PRINT #DECL ("VALUE" <OR 
CHARACTER FALSE STRING> BUFFER)] 181>> 

<PRINTTYPE BUFFER ,BUFFER-PRINT> 

<SETG INIT %<RSUBR-ENTRY '[MSETG INIT #DECL ("VALUE" ATOM)] 228>> 

<SETG ISDISPLAY? %<RSUBR-ENTRY '[MSETG ISDISPLAY? #DECL ("VALUE" <OR ATOM FALSE>
)] 254>> 

<SETG ADDCHR %<RSUBR-ENTRY '[MSETG ADDCHR #DECL ("VALUE" BUFFER BUFFER CHARACTER
)] 265>> 

<SETG BUFTOS %<RSUBR-ENTRY '[MSETG BUFTOS #DECL ("VALUE" STRING BUFFER)] 294>> 

<SETG BUFPRINT %<RSUBR-ENTRY '[MSETG BUFPRINT #DECL ("VALUE" FIX BUFFER 
"OPTIONAL" CHANNEL <OR ATOM FALSE> <OR ATOM FALSE>)] 317>> 

<SETG DOSPRINT %<RSUBR-ENTRY '[MSETG DOSPRINT #DECL ("VALUE" STRING STRING ANY 
"OPTIONAL" <OR ATOM FALSE> FIX)] 531>> 

<SETG GET-CPOS %<RSUBR-ENTRY '[MSETG GET-CPOS #DECL ("VALUE" CHANNEL "OPTIONAL" 
CHANNEL)] 608>> 

<SETG BUFSPRINT %<RSUBR-ENTRY '[MSETG BUFSPRINT #DECL ("VALUE" BUFFER BUFFER 
"OPTIONAL" CHANNEL)] 661>> 

<SETG DELTOCH %<RSUBR-ENTRY '[MSETG DELTOCH #DECL ("VALUE" FIX BUFFER ANY 
"OPTIONAL" <OR STRING FALSE>)] 935>> 

<SETG SAVE-KILL %<RSUBR-ENTRY '[MSETG SAVE-KILL #DECL ("VALUE" BUFFER BUFFER <OR
STRING FALSE>)] 1192>> 

<SETG UNKILL %<RSUBR-ENTRY '[MSETG UNKILL #DECL ("VALUE" BUFFER BUFFER CHARACTER
)] 1289>> 

<SETG TECO-PROGRAM "T"> 

<SETG ERRFCN %<RSUBR-ENTRY '[MSETG ERRFCN #DECL ("VALUE" ANY FRAME "TUPLE" ANY)]
1321>> 

<SETG CHARFCN %<RSUBR-ENTRY '[MSETG CHARFCN #DECL ("VALUE" <OR DISMISS FALSE> 
CHARACTER CHANNEL)] 1388>> 

<OFF <SETG GLOBL-GETSTR-HAND <ON "ERROR" ,ERRFCN 3 0>>> 

<OFF <SETG GLOBL-GETSTR-CHAND <ON "CHAR" ,CHARFCN 7 0 ,INCHAN>>> 
 
<SETG GETSTR %<RSUBR-ENTRY '[MSETG GETSTR #DECL ("VALUE" BUFFER BUFFER 
"OPTIONAL" <OR <LIST [REST VECTOR]> VECTOR> <OR STRING FALSE> STRING)] 1476>> 

<SETG DWORD %<RSUBR-ENTRY '[MSETG DWORD #DECL ("VALUE" FIX BUFFER CHARACTER)] 
1895>> 

<SETG DLINE %<RSUBR-ENTRY '[MSETG DLINE #DECL ("VALUE" FIX BUFFER CHARACTER)] 
1915>> 

<SETG QUOTECHR %<RSUBR-ENTRY '[MSETG QUOTECHR #DECL ("VALUE" BUFFER BUFFER 
CHARACTER)] 1940>> 

<SETG ADDCRLF %<RSUBR-ENTRY '[MSETG ADDCRLF #DECL ("VALUE" BUFFER BUFFER 
CHARACTER)] 1987>> 

<SETG DELCHR %<RSUBR-ENTRY '[MSETG DELCHR #DECL ("VALUE" <OR CHARACTER FALSE> 
BUFFER)] 2052>> 

<SETG IDELCHR %<RSUBR-ENTRY '[MSETG IDELCHR #DECL ("VALUE" <OR CHARACTER FALSE> 
BUFFER CHARACTER)] 2136>> 

<SETG HPOS-BUF %<RSUBR-ENTRY '[MSETG HPOS-BUF #DECL ("VALUE" FIX ANY BUFFER 
"OPTIONAL" <OR ATOM FALSE>)] 2343>> 

<SETG BUFCLEAR %<RSUBR-ENTRY '[MSETG BUFCLEAR #DECL ("VALUE" BUFFER BUFFER)] 
2466>> 

<SETG IBUFCLEAR %<RSUBR-ENTRY '[MSETG IBUFCLEAR #DECL ("VALUE" BUFFER BUFFER 
CHARACTER)] 2482>> 

<SETG IBUFPRINT %<RSUBR-ENTRY '[MSETG IBUFPRINT #DECL ("VALUE" FIX BUFFER 
CHARACTER)] 2516>> 

<SETG LAST-LINE %<RSUBR-ENTRY '[MSETG LAST-LINE #DECL ("VALUE" <OR CHARACTER 
FALSE STRING> BUFFER CHARACTER)] 2578>> 

<SETG FILEINP %<RSUBR-ENTRY '[MSETG FILEINP #DECL ("VALUE" BUFFER BUFFER 
"OPTIONAL" CHARACTER)] 2827>> 

<SETG ADDFILE %<RSUBR-ENTRY '[MSETG ADDFILE #DECL ("VALUE" BUFFER BUFFER CHANNEL
"OPTIONAL" FIX)] 3004>> 

<SETG ADDSTRING %<RSUBR-ENTRY '[MSETG ADDSTRING #DECL ("VALUE" BUFFER BUFFER 
"TUPLE" <TUPLE [REST <OR STRING CHARACTER FIX>]>)] 3191>> 

<SETG ADD-OFFSET-STRING %<RSUBR-ENTRY '[MSETG ADD-OFFSET-STRING #DECL ("VALUE" 
BUFFER BUFFER STRING STRING)] 3308>> 

<SET CHRTABLE [!\ ,FILEINP !\ ,IDELCHR <ASCII 13>
,ADDCRLF <ASCII 12> ,IBUFPRINT !\ ,IBUFPRINT !\ ,UNKILL !\ ,QUOTECHR !\ 
,LAST-LINE !\ <FUNCTION (BUF CHR) <RETURN .BUF .GETSTRACT>> !\ ,DLINE !\ ,
DWORD !\ ,DLINE <ASCII 0> ,IBUFCLEAR]> 

<ENDPACKAGE> 
