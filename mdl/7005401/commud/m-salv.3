<SETG M
'[
132982 "COMDAT;MSG ASYLUM"
132688 "COMDAT;132688 ASYLUM"
132371 "COMDAT;132371 ASYLUM"
132099 "COMDAT;132099 ASYLUM"
131804 "COMDAT;131804 ASYLUM"
131494 "COMDAT;131494 ASYLUM"
]>

<SETG Q
'(0)>

<SETG H 133300>

<DEFINE DOIT ()
	<INIT-SPACES>
	<COND (<SETG SYSTEM-ASYLUM <OPEN-DATA-FILE "COMDAT;SYSTEM ASYLUM">>)
	      (ELSE
	       <ERROR SYSTEM ,SYSTEM-ASYLUM>)>
	<COND (<NOT <SET R <DATA-APRINT ,SYSTEM-ASYLUM
					,COMSYS-MSG-MAP
					<ARESET ,SCRATCH-SPACE>
					<ACOPY ,SCRATCH-SPACE ,M>>>>
	       <ERROR MAP .R>)>
	<COND (<NOT <SET R <DATA-APRINT ,SYSTEM-ASYLUM
					,COMSYS-PENDING-QUEUE
					<ARESET ,QUEUE-SPACE>
					<ACOPY ,QUEUE-SPACE ,Q>>>>
	       <ERROR QUEUE .R>)>
	<COND (<NOT <SET R <DATA-PRINTW ,SYSTEM-ASYLUM
					,COMSYS-MSG-MAP
					,H>>>
	       <ERROR NEXT .R>)>>

<DEFINE PN ("OPTIONAL" (N <HIGH-MESSAGE-ID>) "AUX" P)
	<MAPF <>
	      <FUNCTION ()
		   <COND (<MREAD <SET N <- .N 1>>>
			  <MAPF <>
				<FUNCTION (U)
				     <SET P <DRDMSG .U "PROCESSING-NEEDED">>
				     <COND (<AND .P
						 <NOT <EMPTY? <SET P <REST .P>>>>>
					    <PRINT .N>
					    <PRIN1 .U>
					    <PRINC !\ >
					    <PRIN1 .P>)>>
				<DUSERS>>)>>>>
