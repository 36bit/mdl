<SETG M
'[
239016 "COMDAT;MSG ASYLUM"
238774 "COMDAT;238774 ASYLUM"
238519 "COMDAT;238519 ASYLUM"
238283 "COMDAT;238283 ASYLUM"
238089 "COMDAT;238089 ASYLUM"
237883 "COMDAT;237833 ASYLUM"
237566 "COMDAT;237566 ASYLUM"
237355 "COMDAT;237355 ASYLUM"
237124 "COMDAT;237124 ASYLUM"
]>

<SETG Q
'(0)>

<SETG H 239038>

<DEFINE DOIT ()
	<INIT-SPACES>
	<COND (<SETG SYSTEM-ASYLUM <OPEN-DATA-FILE "COMDAT;SYSTEM ASYLUM">>)
	      (ELSE
	       <ERROR SYSTEM ,SYSTEM-ASYLUM>)>
	<COND (<NOT <SET R <DATA-APRINT ,SYSTEM-ASYLUM
					,COMSYS-MSG-MAP
					<ARESET ,SCRATCH-SPACE>
					<ACOPY ,SCRATCH-SPACE ,M>>>>
	       <ERROR MAP .R>)>
	<COND (<NOT <SET R <DATA-APRINT ,SYSTEM-ASYLUM
					,COMSYS-PENDING-QUEUE
					<ARESET ,QUEUE-SPACE>
					<ACOPY ,QUEUE-SPACE ,Q>>>>
	       <ERROR QUEUE .R>)>
	<COND (<NOT <SET R <DATA-PRINTW ,SYSTEM-ASYLUM
					,COMSYS-MSG-MAP
					,H>>>
	       <ERROR NEXT .R>)>>

<DEFINE PN ("OPTIONAL" (N <HIGH-MESSAGE-ID>) "AUX" P (QQ (0)) (Q .QQ))
	<MAPF
	  <>
	  <FUNCTION ()
	    <COND (<MREAD <SET N <- .N 1>>>
		   <MAPF <>
			 <FUNCTION (U "AUX" WHEN)
			      <COND (<SET WHEN <SCHEDULED? .U>>
				     <PUTREST .Q
					      <SET Q ((.N
						       <STRING .U>
						       .WHEN))>>
				     <PRINT .N>
				     <PRIN1 .U>)>>
			 <DUSERS>>)>>>
	.QQ>

<DEFINE SCHEDULED? (U "AUX" P)
	<COND (<AND <SET P
			 <DRDMSG .U "PROCESSING-NEEDED">>
		    <NOT <EMPTY? <SET P <REST .P>>>>>
	       <MAPF <>
		     <FUNCTION (PP)
			  <COND (<N==? <2 .PP> -1>
				 <MAPLEAVE <2 .PP>>)>>
		     .P>)>>

